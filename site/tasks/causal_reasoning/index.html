
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Reasoning Core library">
      
      
        <meta name="author" content="Magnet Team">
      
      
        <link rel="canonical" href="https://vlcmb.github.io/reasoning-core-demo/tasks/causal_reasoning/">
      
      
        <link rel="prev" href="../arithmetics/">
      
      
        <link rel="next" href="../coding/">
      
      
        
      
      
      <link rel="icon" href="../../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Causal Reasoning - Reasoning Core</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#causal-reasoning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Reasoning Core" class="md-header__button md-logo" aria-label="Reasoning Core" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Reasoning Core
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Causal Reasoning
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vlcmb/reasoning-core-demo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    reasoning_core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Reasoning Core" class="md-nav__button md-logo" aria-label="Reasoning Core" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    Reasoning Core
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vlcmb/reasoning-core-demo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    reasoning_core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Template
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/Arithmetics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Arithmetic Reasoning with Reasoning Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/Causal_reasoning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating a Causal Reasoning Dataset with Reasoning Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arithmetics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Arithmetics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Causal Reasoning
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Causal Reasoning
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning" class="md-nav__link">
    <span class="md-ellipsis">
      
        causal_reasoning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="causal_reasoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        BinaryInfluenceModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BinaryInfluenceModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultilevelInfluenceModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultilevelInfluenceModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReasoningGraph
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReasoningGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.convert_complex_nodes_to_ci" class="md-nav__link">
    <span class="md-ellipsis">
      
        convert_complex_nodes_to_ci
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.do_to_NL" class="md-nav__link">
    <span class="md-ellipsis">
      
        do_to_NL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.evidences_to_NL" class="md-nav__link">
    <span class="md-ellipsis">
      
        evidences_to_NL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bonded_rung1" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_bonded_rung1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bonded_rung2" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_bonded_rung2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bounded_rung1_and_rung2" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_bounded_rung1_and_rung2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_rung1" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_rung1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_rung2" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_rung2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rung
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung.score_answer" class="md-nav__link">
    <span class="md-ellipsis">
      
        score_answer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rung12Config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rung12Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config.set_seed" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_seed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config.set_seed--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.SemanticTraceVE" class="md-nav__link">
    <span class="md-ellipsis">
      
        SemanticTraceVE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SemanticTraceVE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.SemanticTraceVE-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.SemanticTraceVE.generate_natural_language_proof" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_natural_language_proof
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.bim_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        bim_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.bn_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        bn_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.cpd_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        cpd_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.factor_to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        factor_to_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_CI" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_random_CI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DAG" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_random_DAG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_random_DBN
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_random_DBN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_robust_elimination_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_robust_elimination_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.js_divergence" class="md-nav__link">
    <span class="md-ellipsis">
      
        js_divergence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.js_reward" class="md-nav__link">
    <span class="md-ellipsis">
      
        js_reward
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.mim_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        mim_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_BIM" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_BIM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_nl_BIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_BIM--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_CPD" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_CPD
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_nl_CPD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_CPD--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_DBN" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_DBN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_MIM" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_MIM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_nl_MIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_MIM--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../coding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../equation_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Equation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../formal_maths/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Formal Maths
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grammar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grammar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph_operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graph Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Planning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regex_following/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regex Following
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rung3_reasoning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rung3 Reasoning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sequential_induction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sequential Induction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../set_operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Set Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../table_qa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Table QA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning" class="md-nav__link">
    <span class="md-ellipsis">
      
        causal_reasoning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="causal_reasoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        BinaryInfluenceModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BinaryInfluenceModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultilevelInfluenceModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultilevelInfluenceModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReasoningGraph
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReasoningGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.convert_complex_nodes_to_ci" class="md-nav__link">
    <span class="md-ellipsis">
      
        convert_complex_nodes_to_ci
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.do_to_NL" class="md-nav__link">
    <span class="md-ellipsis">
      
        do_to_NL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.evidences_to_NL" class="md-nav__link">
    <span class="md-ellipsis">
      
        evidences_to_NL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bonded_rung1" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_bonded_rung1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bonded_rung2" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_bonded_rung2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bounded_rung1_and_rung2" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_bounded_rung1_and_rung2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_rung1" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_rung1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_rung2" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_rung2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.ReasoningGraph.predict" class="md-nav__link">
    <span class="md-ellipsis">
      
        predict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rung
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rung">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung.score_answer" class="md-nav__link">
    <span class="md-ellipsis">
      
        score_answer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rung12Config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rung12Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config.set_seed" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_seed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.Rung12Config.set_seed--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.SemanticTraceVE" class="md-nav__link">
    <span class="md-ellipsis">
      
        SemanticTraceVE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SemanticTraceVE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.SemanticTraceVE-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.SemanticTraceVE.generate_natural_language_proof" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_natural_language_proof
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.bim_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        bim_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.bn_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        bn_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.cpd_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        cpd_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.factor_to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        factor_to_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_CI" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_random_CI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DAG" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_random_DAG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_random_DBN
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_random_DBN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_random_DBN--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.get_robust_elimination_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_robust_elimination_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.js_divergence" class="md-nav__link">
    <span class="md-ellipsis">
      
        js_divergence
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.js_reward" class="md-nav__link">
    <span class="md-ellipsis">
      
        js_reward
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.mim_round" class="md-nav__link">
    <span class="md-ellipsis">
      
        mim_round
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_BIM" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_BIM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_nl_BIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_BIM--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_CPD" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_CPD
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_nl_CPD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_CPD--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_DBN" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_DBN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_MIM" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_nl_MIM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_nl_MIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reasoning_core.tasks.causal_reasoning.to_nl_MIM--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="causal-reasoning">Causal Reasoning</h1>


<div class="doc doc-object doc-module">



<h2 id="reasoning_core.tasks.causal_reasoning" class="doc doc-heading">
            <code>reasoning_core.tasks.causal_reasoning</code>


</h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">







<h3 id="reasoning_core.tasks.causal_reasoning-classes">Classes</h3>

<div class="doc doc-object doc-class">



<h4 id="reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel" class="doc doc-heading">
            <code>BinaryInfluenceModel</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pgmpy.factors.discrete.TabularCPD">TabularCPD</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BinaryInfluenceModel</span><span class="p">(</span><span class="n">TabularCPD</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">variable</span><span class="p">,</span>
        <span class="n">evidence</span><span class="p">,</span>
        <span class="n">activation_magnitude</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span>
        <span class="n">leak</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">isboolean_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">state_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A mechanistically defined CPD for Noisy-OR / Noisy-AND logic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span> <span class="s2">&quot;AND&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be either &#39;OR&#39; or &#39;AND&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isboolean_style</span> <span class="o">=</span> <span class="n">isboolean_style</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">activation_magnitude</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">leak</span><span class="p">])</span> <span class="k">if</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span> <span class="o">=</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># --- FIX: Renamed back to self.evidence for compatibility with to_nl ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span> 

        <span class="c1"># Prepare State Names (Robustly)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isboolean_style</span><span class="p">:</span>
            <span class="n">default_states</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_states</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">all_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span> <span class="o">=</span> <span class="n">_fill_missing_state_names</span><span class="p">(</span><span class="n">all_vars</span><span class="p">,</span> <span class="n">state_names</span><span class="p">,</span> <span class="n">default_states</span><span class="p">)</span>

        <span class="c1"># Calculate Probability Table</span>
        <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">):</span>
            <span class="n">evidence_inst</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">combo</span><span class="p">))</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">evidence_inst</span><span class="p">)</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

        <span class="n">cpd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Canonical Initialization</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">variable_card</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="n">cpd_values</span><span class="p">,</span>
            <span class="n">evidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span>
            <span class="n">evidence_card</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">),</span>
            <span class="n">state_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evidence_instantiate</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">active_mask</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">evidence_instantiate</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
            <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
            <span class="n">active_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">active_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">active_mask</span><span class="p">)</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span><span class="p">[</span><span class="n">active_mask</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;OR&quot;</span><span class="p">:</span>
            <span class="n">p_active</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">probs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span>
                <span class="n">p_active</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_active</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># AND</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">active_mask</span><span class="p">):</span>
                <span class="n">p_active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_active</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span>
                    <span class="n">p_active</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_active</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_active</span><span class="p">,</span> <span class="n">p_active</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_cpd</span> <span class="o">=</span> <span class="n">BinaryInfluenceModel</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">evidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="c1"># Use stored evidence</span>
            <span class="n">activation_magnitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">leak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">isboolean_style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isboolean_style</span><span class="p">,</span>
            <span class="n">state_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_cpd</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">








<h5 id="reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.BinaryInfluenceModel.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">activation_magnitude</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;OR&#39;</span><span class="p">,</span> <span class="n">leak</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isboolean_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">state_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>A mechanistically defined CPD for Noisy-OR / Noisy-AND logic.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">evidence</span><span class="p">,</span>
    <span class="n">activation_magnitude</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span>
    <span class="n">leak</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">isboolean_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">state_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mechanistically defined CPD for Noisy-OR / Noisy-AND logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span> <span class="s2">&quot;AND&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be either &#39;OR&#39; or &#39;AND&#39;&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">isboolean_style</span> <span class="o">=</span> <span class="n">isboolean_style</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">activation_magnitude</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">leak</span><span class="p">])</span> <span class="k">if</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span> <span class="o">=</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># --- FIX: Renamed back to self.evidence for compatibility with to_nl ---</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span> 

    <span class="c1"># Prepare State Names (Robustly)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isboolean_style</span><span class="p">:</span>
        <span class="n">default_states</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">default_states</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">all_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span> <span class="o">=</span> <span class="n">_fill_missing_state_names</span><span class="p">(</span><span class="n">all_vars</span><span class="p">,</span> <span class="n">state_names</span><span class="p">,</span> <span class="n">default_states</span><span class="p">)</span>

    <span class="c1"># Calculate Probability Table</span>
    <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">):</span>
        <span class="n">evidence_inst</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">combo</span><span class="p">))</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">evidence_inst</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

    <span class="n">cpd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Canonical Initialization</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
        <span class="n">variable_card</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="n">cpd_values</span><span class="p">,</span>
        <span class="n">evidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span>
        <span class="n">evidence_card</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">),</span>
        <span class="n">state_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel" class="doc doc-heading">
            <code>MultilevelInfluenceModel</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pgmpy.factors.discrete.TabularCPD">TabularCPD</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MultilevelInfluenceModel</span><span class="p">(</span><span class="n">TabularCPD</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">influence_tables</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">leak</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;MAX&quot;</span><span class="p">,</span> <span class="n">state_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A mechanistically defined CPD for Min/Max logic on multi-state variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;MAX&quot;</span><span class="p">,</span> <span class="s2">&quot;MIN&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be &#39;MAX&#39; or &#39;MIN&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span> <span class="o">=</span> <span class="n">influence_tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">leak</span><span class="p">)</span> <span class="k">if</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span> <span class="o">=</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># --- FIX: Renamed back to self.evidence for compatibility with to_nl ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span>

        <span class="c1"># Prepare State Names (Robustly)</span>
        <span class="n">temp_state_names</span> <span class="o">=</span> <span class="n">state_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">state_names</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_state_names</span><span class="p">:</span>
            <span class="n">temp_state_names</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_state_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">influence_tables</span><span class="p">:</span>
                    <span class="n">temp_state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp_state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span> <span class="o">=</span> <span class="n">temp_state_names</span>

        <span class="c1"># Pre-calculate Cumulative Tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_tables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">p</span><span class="p">:</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">probs</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">influence_tables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">leak</span><span class="p">)</span> <span class="k">if</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

        <span class="c1"># Calculate Probability Table</span>
        <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">combo</span><span class="p">))</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Canonical Initialization</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">variable_card</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
            <span class="n">evidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span>
            <span class="n">evidence_card</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">],</span>
            <span class="n">state_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;probabilities&quot;</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must be between 0 and 1.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> must sum to 1. Got </span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evidence_instantiate</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
            <span class="n">cum_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">evidence_instantiate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">val</span><span class="p">]</span>
                <span class="n">cum_prob</span> <span class="o">*=</span> <span class="n">theta</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span>
                <span class="n">cum_prob</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_leak</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;MIN&quot;</span><span class="p">:</span>
            <span class="n">complement_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">evidence_instantiate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">val</span><span class="p">]</span>
                <span class="n">complement_prod</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span>
                <span class="n">complement_prod</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_leak</span><span class="p">)</span>
            <span class="n">cum_prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">complement_prod</span>

        <span class="n">cum_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cum_prob</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">cum_prob</span><span class="p">)))</span>

        <span class="n">total</span> <span class="o">=</span> <span class="n">probs</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="n">probs</span> <span class="o">/</span> <span class="n">total</span>
        <span class="k">return</span> <span class="n">probs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_cpd</span> <span class="o">=</span> <span class="n">MultilevelInfluenceModel</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">evidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="c1"># Use stored evidence</span>
            <span class="n">influence_tables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">,</span> 
            <span class="n">levels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span>
            <span class="n">leak</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">state_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_cpd</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">








<h5 id="reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.MultilevelInfluenceModel.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">influence_tables</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">leak</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="n">state_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>A mechanistically defined CPD for Min/Max logic on multi-state variables.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">influence_tables</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">leak</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;MAX&quot;</span><span class="p">,</span> <span class="n">state_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mechanistically defined CPD for Min/Max logic on multi-state variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;MAX&quot;</span><span class="p">,</span> <span class="s2">&quot;MIN&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be &#39;MAX&#39; or &#39;MIN&#39;&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span> <span class="o">=</span> <span class="n">influence_tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">leak</span><span class="p">)</span> <span class="k">if</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span> <span class="o">=</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># --- FIX: Renamed back to self.evidence for compatibility with to_nl ---</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span>

    <span class="c1"># Prepare State Names (Robustly)</span>
    <span class="n">temp_state_names</span> <span class="o">=</span> <span class="n">state_names</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">state_names</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_state_names</span><span class="p">:</span>
        <span class="n">temp_state_names</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_state_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">influence_tables</span><span class="p">:</span>
                <span class="n">temp_state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span> <span class="o">=</span> <span class="n">temp_state_names</span>

    <span class="c1"># Pre-calculate Cumulative Tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_tables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">p</span><span class="p">:</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">probs</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">influence_tables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">leak</span><span class="p">)</span> <span class="k">if</span> <span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

    <span class="c1"># Calculate Probability Table</span>
    <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">combo</span><span class="p">))</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Canonical Initialization</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
        <span class="n">variable_card</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span>
        <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
        <span class="n">evidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span>
        <span class="n">evidence_card</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">],</span>
        <span class="n">state_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph" class="doc doc-heading">
            <code>ReasoningGraph</code>


</h4>


    <div class="doc doc-contents ">










              <details class="mkdocstrings-source">
                <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReasoningGraph</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bn</span><span class="p">:</span> <span class="n">DiscreteBayesianNetwork</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bn</span> <span class="o">=</span> <span class="n">bn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bn</span> <span class="o">=</span> <span class="n">DiscreteBayesianNetwork</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_new_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_domain_size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;erdos&#39;</span><span class="p">)</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">conditionning_seed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;conditionning_seed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">edge_prob</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;edge_prob&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bn</span> <span class="o">=</span> <span class="n">DiscreteBayesianNetwork</span><span class="o">.</span><span class="n">get_random</span><span class="p">(</span>
        <span class="n">n_nodes</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span>
        <span class="n">edge_prob</span> <span class="o">=</span> <span class="n">edge_prob</span><span class="p">,</span>
        <span class="n">n_states</span> <span class="o">=</span> <span class="p">[</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">max_domain_size</span><span class="p">)],</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="p">,</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">,</span>
        <span class="n">conditionning_seed</span> <span class="o">=</span> <span class="n">conditionning_seed</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ie</span> <span class="o">=</span> <span class="n">CausalVE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span> <span class="c1">#Causal Variable Elimination Home Made</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_var</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_rung1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets up an observational query (Rung 1).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>

        <span class="c1"># Local RNG  isolated seed, no global contamination</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

        <span class="n">variables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">n_evidence</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
        <span class="n">evidence_variables</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">n_evidence</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">evidence_variables</span><span class="p">:</span>
            <span class="n">possible_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_values</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_rung2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets up an interventional query (Rung 2).&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>


        <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

        <span class="n">variables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

        <span class="n">do_var</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="n">possible_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">do_var</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">do_var</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_values</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_var</span> <span class="o">=</span> <span class="n">do_var</span>

        <span class="n">variables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">do_var</span><span class="p">)</span>

        <span class="n">n_evidence</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
        <span class="n">evidence_variables</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">n_evidence</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">evidence_variables</span><span class="p">:</span>
            <span class="n">possible_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_values</span><span class="p">)</span>

<span class="c1">#### Bounded Generation ####</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate matched Rung1 and Rung2 queries from the same seed.&quot;&quot;&quot;</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

        <span class="n">remaining_vars</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">remaining_vars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="n">n_evidence</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_vars</span><span class="p">))</span> <span class="c1"># up to len(remaining_var) - 1</span>
        <span class="n">evidence_vars</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">remaining_vars</span><span class="p">,</span> <span class="n">n_evidence</span><span class="p">)</span>

        <span class="n">evidence_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">evidence_vars</span><span class="p">:</span>
            <span class="n">evidence_values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>

        <span class="n">do_var</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">evidence_vars</span><span class="p">)</span>
        <span class="n">do_value</span> <span class="o">=</span> <span class="n">evidence_values</span><span class="p">[</span><span class="n">do_var</span><span class="p">]</span>

        <span class="c1"># Rung2 evidence is Rung1 evidence minus the promoted do-var</span>
        <span class="n">evidence_vars_r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">evidence_vars</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">do_var</span><span class="p">]</span>
        <span class="n">evidence_values_r2</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">evidence_values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">evidence_vars_r2</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_r1_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r1_evidence_values</span> <span class="o">=</span> <span class="n">evidence_values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_r2_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_var</span> <span class="o">=</span> <span class="n">do_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">do_var</span><span class="p">:</span> <span class="n">do_value</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r2_evidence_values</span> <span class="o">=</span> <span class="n">evidence_values_r2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_bonded_rung1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds Rung1 using precomputed aligned data.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r1_target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r1_evidence_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">generate_bonded_rung2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds Rung2 using precomputed aligned data.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_evidence_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1">#### End bounded generation ####</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiscreteFactor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make observational predictions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Inference engine not initialized. Generate a graph first.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ie</span><span class="o">.</span><span class="n">query</span><span class="p">(</span> <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">evidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">,</span> <span class="n">do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">do_to_NL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert interventional evidence to NL.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;Doing/Imposing that &quot;</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;, and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the state </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> is equal to </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
                                 <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evidences_to_NL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert observational evidence to NL.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;Observing/Knowing that &quot;</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;, and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the state </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> is equal to </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
                                 <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;Without further Observation/Knowledge of other variable.&quot;</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">target_to_NL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Provide the probability over the state named </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_NL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>     
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">to_nl</span><span class="p">(</span><span class="n">n_round</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_complex_nodes_to_ci</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">cpt_relative_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">binari_ci_modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">],</span>
        <span class="n">multi_ci_modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span>
        <span class="n">n_round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Post-processing step to convert large TabularCPDs to CI models.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">converted_nodes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">old_cpd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">get_cpds</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_cpd</span><span class="p">,</span> <span class="n">TabularCPD</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">cpt_relative_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">old_cpd</span><span class="o">.</span><span class="n">size_full</span><span class="p">()</span> <span class="o">-</span> <span class="n">old_cpd</span><span class="o">.</span><span class="n">size_CI_model</span><span class="p">())</span><span class="o">/</span><span class="n">old_cpd</span><span class="o">.</span><span class="n">size_CI_model</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">cpt_relative_diff</span> <span class="o">&gt;</span> <span class="n">cpt_relative_threshold</span><span class="p">:</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">all_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+</span> <span class="n">parents</span>
                <span class="n">cardinalities</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">get_cardinality</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vars</span><span class="p">}</span>
                <span class="n">child_card</span> <span class="o">=</span> <span class="n">cardinalities</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                <span class="n">parent_cards</span> <span class="o">=</span> <span class="p">[</span><span class="n">cardinalities</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">]</span>

                <span class="n">new_cpd</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">child_card</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">parent_cards</span><span class="p">):</span>
                    <span class="n">chosen_mode</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">binari_ci_modes</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chosen_mode</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">multi_ci_modes</span><span class="p">)</span>
                <span class="n">new_cpd</span> <span class="o">=</span> <span class="n">get_random_CI</span><span class="p">(</span>
                        <span class="n">variable</span> <span class="o">=</span> <span class="n">node</span><span class="p">,</span>
                        <span class="n">evidence</span> <span class="o">=</span> <span class="n">parents</span><span class="p">,</span>
                        <span class="n">cardinality</span> <span class="o">=</span> <span class="n">cardinalities</span><span class="p">,</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="n">chosen_mode</span><span class="p">,</span>
                        <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n_round</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new_cpd</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_cpd</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">remove_cpds</span><span class="p">(</span><span class="n">old_cpd</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">add_cpds</span><span class="p">(</span><span class="n">new_cpd</span><span class="p">)</span>
                    <span class="n">converted_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">ie</span> <span class="o">=</span> <span class="n">CausalVE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">converted_nodes</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">








<h5 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.convert_complex_nodes_to_ci" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_complex_nodes_to_ci</span><span class="p">(</span><span class="n">cpt_relative_threshold</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">binari_ci_modes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">],</span> <span class="n">multi_ci_modes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">n_round</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Post-processing step to convert large TabularCPDs to CI models.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_complex_nodes_to_ci</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">cpt_relative_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">binari_ci_modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">],</span>
    <span class="n">multi_ci_modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span>
    <span class="n">n_round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Post-processing step to convert large TabularCPDs to CI models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">converted_nodes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="n">old_cpd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">get_cpds</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_cpd</span><span class="p">,</span> <span class="n">TabularCPD</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">cpt_relative_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">old_cpd</span><span class="o">.</span><span class="n">size_full</span><span class="p">()</span> <span class="o">-</span> <span class="n">old_cpd</span><span class="o">.</span><span class="n">size_CI_model</span><span class="p">())</span><span class="o">/</span><span class="n">old_cpd</span><span class="o">.</span><span class="n">size_CI_model</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cpt_relative_diff</span> <span class="o">&gt;</span> <span class="n">cpt_relative_threshold</span><span class="p">:</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">all_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+</span> <span class="n">parents</span>
            <span class="n">cardinalities</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">get_cardinality</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vars</span><span class="p">}</span>
            <span class="n">child_card</span> <span class="o">=</span> <span class="n">cardinalities</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="n">parent_cards</span> <span class="o">=</span> <span class="p">[</span><span class="n">cardinalities</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">]</span>

            <span class="n">new_cpd</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">child_card</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">parent_cards</span><span class="p">):</span>
                <span class="n">chosen_mode</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">binari_ci_modes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chosen_mode</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">multi_ci_modes</span><span class="p">)</span>
            <span class="n">new_cpd</span> <span class="o">=</span> <span class="n">get_random_CI</span><span class="p">(</span>
                    <span class="n">variable</span> <span class="o">=</span> <span class="n">node</span><span class="p">,</span>
                    <span class="n">evidence</span> <span class="o">=</span> <span class="n">parents</span><span class="p">,</span>
                    <span class="n">cardinality</span> <span class="o">=</span> <span class="n">cardinalities</span><span class="p">,</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="n">chosen_mode</span><span class="p">,</span>
                    <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n_round</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_cpd</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_cpd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">remove_cpds</span><span class="p">(</span><span class="n">old_cpd</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">add_cpds</span><span class="p">(</span><span class="n">new_cpd</span><span class="p">)</span>
                <span class="n">converted_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">ie</span> <span class="o">=</span> <span class="n">CausalVE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">converted_nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.do_to_NL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_to_NL</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Convert interventional evidence to NL.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">do_to_NL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert interventional evidence to NL.&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;Doing/Imposing that &quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;, and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the state </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> is equal to </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
                             <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.evidences_to_NL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evidences_to_NL</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Convert observational evidence to NL.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evidences_to_NL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert observational evidence to NL.&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;Observing/Knowing that &quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;, and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the state </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2"> is equal to </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
                             <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;Without further Observation/Knowledge of other variable.&quot;</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bonded_rung1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_bonded_rung1</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Builds Rung1 using precomputed aligned data.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_bonded_rung1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builds Rung1 using precomputed aligned data.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r1_target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r1_evidence_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bonded_rung2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_bonded_rung2</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Builds Rung2 using precomputed aligned data.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_bonded_rung2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builds Rung2 using precomputed aligned data.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">do_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_var</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2_evidence_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_bounded_rung1_and_rung2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Generate matched Rung1 and Rung2 queries from the same seed.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_bounded_rung1_and_rung2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate matched Rung1 and Rung2 queries from the same seed.&quot;&quot;&quot;</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

    <span class="n">remaining_vars</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">remaining_vars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="n">n_evidence</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_vars</span><span class="p">))</span> <span class="c1"># up to len(remaining_var) - 1</span>
    <span class="n">evidence_vars</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">remaining_vars</span><span class="p">,</span> <span class="n">n_evidence</span><span class="p">)</span>

    <span class="n">evidence_values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">evidence_vars</span><span class="p">:</span>
        <span class="n">evidence_values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>

    <span class="n">do_var</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">evidence_vars</span><span class="p">)</span>
    <span class="n">do_value</span> <span class="o">=</span> <span class="n">evidence_values</span><span class="p">[</span><span class="n">do_var</span><span class="p">]</span>

    <span class="c1"># Rung2 evidence is Rung1 evidence minus the promoted do-var</span>
    <span class="n">evidence_vars_r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">evidence_vars</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">do_var</span><span class="p">]</span>
    <span class="n">evidence_values_r2</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">evidence_values</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">evidence_vars_r2</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_r1_target</span> <span class="o">=</span> <span class="n">target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_r1_evidence_values</span> <span class="o">=</span> <span class="n">evidence_values</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_r2_target</span> <span class="o">=</span> <span class="n">target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_var</span> <span class="o">=</span> <span class="n">do_var</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_r2_do_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">do_var</span><span class="p">:</span> <span class="n">do_value</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_r2_evidence_values</span> <span class="o">=</span> <span class="n">evidence_values_r2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_rung1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_rung1</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Sets up an observational query (Rung 1).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_rung1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up an observational query (Rung 1).&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>

    <span class="c1"># Local RNG  isolated seed, no global contamination</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

    <span class="n">variables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="n">n_evidence</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
    <span class="n">evidence_variables</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">n_evidence</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">evidence_variables</span><span class="p">:</span>
        <span class="n">possible_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.generate_rung2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_rung2</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Sets up an interventional query (Rung 2).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_rung2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets up an interventional query (Rung 2).&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reset_inference</span><span class="p">()</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>


    <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

    <span class="n">variables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

    <span class="n">do_var</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
    <span class="n">possible_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">do_var</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">do_var</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_values</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">do_var</span> <span class="o">=</span> <span class="n">do_var</span>

    <span class="n">variables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">do_var</span><span class="p">)</span>

    <span class="n">n_evidence</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>
    <span class="n">evidence_variables</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">n_evidence</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">evidence_variables</span><span class="p">:</span>
        <span class="n">possible_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.ReasoningGraph.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Make observational predictions.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiscreteFactor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make observational predictions.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Inference engine not initialized. Generate a graph first.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ie</span><span class="o">.</span><span class="n">query</span><span class="p">(</span> <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">],</span> <span class="n">evidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence_values</span><span class="p">,</span> <span class="n">do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_values</span> <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="reasoning_core.tasks.causal_reasoning.Rung" class="doc doc-heading">
            <code>Rung</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="reasoning_core.tasks._causal_utils.ABC">ABC</span></code></p>



        <p>An abstract base class for Rung tasks of any degree.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Rung</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An abstract base class for Rung tasks of any degree.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Rung12Config</span><span class="p">(),</span> <span class="n">bn</span><span class="p">:</span> <span class="n">DiscreteBayesianNetwork</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span> <span class="o">=</span> <span class="n">ReasoningGraph</span><span class="p">(</span><span class="n">bn</span><span class="o">=</span><span class="n">bn</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_specific_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_answer_and_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_construct_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">n_round</span> <span class="c1">#stochastic rounding value, that we will use for all subfunction to be coherent within the example    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_network</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">graph_generation_mode</span><span class="p">,</span>
            <span class="n">edge_prob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">edge_prob</span><span class="p">,</span>
            <span class="n">max_domain_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_domain_size</span><span class="p">,</span>
            <span class="n">n_round</span> <span class="o">=</span> <span class="n">n_round</span><span class="p">,</span>
           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_specific_problem</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>

        <span class="n">answer</span><span class="p">,</span> <span class="n">specific_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_answer_and_metadata</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>
        <span class="n">cot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span><span class="o">.</span><span class="n">ie</span><span class="o">.</span><span class="n">generate_natural_language_proof</span><span class="p">(</span><span class="n">scientific_notation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cot_scientific_notation</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">n_round</span><span class="p">,</span> <span class="n">concise</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">concise_cot</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">nan</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span> <span class="c1">#Create another scenario if this one is probabilistically impossible.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">graph_seed</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">graph_seed</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_specific_problem</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>
            <span class="n">answer</span><span class="p">,</span> <span class="n">specific_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_answer_and_metadata</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_scenario</span><span class="p">()</span>
        <span class="n">target_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>

        <span class="n">writer</span> <span class="o">=</span> <span class="n">CanonicalBIFWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span>
        <span class="n">bif_data</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">write_string</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;nan&#39;</span> <span class="ow">in</span> <span class="n">cot</span><span class="p">:</span> <span class="c1">#case where the problem is tricky for concise Cot solving</span>
            <span class="n">cot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;target_var_values&quot;</span><span class="p">:</span> <span class="n">target_vals</span><span class="p">,</span>
            <span class="s2">&quot;bif_description&quot;</span><span class="p">:</span><span class="n">bif_data</span><span class="p">,</span>
            <span class="s2">&quot;scenario&quot;</span><span class="p">:</span> <span class="n">scenario</span><span class="p">,</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reason_graph</span><span class="o">.</span><span class="n">bn</span><span class="o">.</span><span class="n">nodes</span><span class="p">()),</span>
            <span class="s2">&quot;n_round&quot;</span><span class="p">:</span> <span class="n">n_round</span><span class="p">,</span>
            <span class="s2">&quot;cot&quot;</span><span class="p">:</span> <span class="n">cot</span>
        <span class="p">}</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">specific_metadata</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Problem</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="n">answer</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
        <span class="n">bif_data</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;bif_description&quot;</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ReasoningGraph</span><span class="p">(</span><span class="n">CanonicalBIFReader</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">bif_data</span><span class="p">)</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
        <span class="n">n_round</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;n_round&#39;</span><span class="p">]</span>
        <span class="n">system_description</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_NL</span><span class="p">(</span><span class="n">n_round</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_verbose</span><span class="p">)</span> 

        <span class="n">target</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;target_var_values&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;System:</span><span class="se">\n</span><span class="si">{</span><span class="n">system_description</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Observed conditions:</span><span class="se">\n</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;scenario&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Task: Compute probability distribution for </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> (possible values: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">).</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Output: Python dict mapping each value to its probability, rounded to </span><span class="si">{</span><span class="n">n_round</span><span class="si">}</span><span class="s2"> decimals.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Example: </span><span class="se">{{</span><span class="s2">0: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.123456789</span><span class="p">,</span><span class="n">n_round</span><span class="p">)</span><span class="si">}</span><span class="s2">, 1: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.876543211</span><span class="p">,</span><span class="n">n_round</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">cot</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">score_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shared scoring function.&quot;&quot;&quot;</span>
        <span class="n">dict_truth</span> <span class="o">=</span> <span class="n">_to_dict</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dict_pred</span> <span class="o">=</span> <span class="n">_to_dict</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">js_reward</span><span class="p">(</span><span class="n">dict_truth</span><span class="p">,</span> <span class="n">dict_pred</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">








<h5 id="reasoning_core.tasks.causal_reasoning.Rung-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.Rung.score_answer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">score_answer</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Shared scoring function.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">score_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shared scoring function.&quot;&quot;&quot;</span>
    <span class="n">dict_truth</span> <span class="o">=</span> <span class="n">_to_dict</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">answer</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dict_pred</span> <span class="o">=</span> <span class="n">_to_dict</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">js_reward</span><span class="p">(</span><span class="n">dict_truth</span><span class="p">,</span> <span class="n">dict_pred</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="reasoning_core.tasks.causal_reasoning.Rung12Config" class="doc doc-heading">
            <code>Rung12Config</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="reasoning_core.template.Config


  
      dataclass
   (reasoning_core.tasks._causal_utils.Config)" href="../../template/#reasoning_core.template.Config">Config</a></code></p>



        <p>Configuration for Rung 1 and Rung 2 tasks.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.Rung12Config--parameters">Parameters</h6>
<p>n_nodes : int
    Number of nodes in the graph.
max_domain_size : int
    Maximum domain size for the variables.
edge_prob : float
    Probability of an edge between two nodes.
graph_generation_mode : str
    Method for generating the graph (e.g., "erdos").
n_round : int
    Number of decimal places to round probabilities to.
Noisy_mode : bool
    Whether to use the sparser Noisy interaction within the network.
cpt_relative_threshold : float
    If Noisy_mode is True, set the conversion relative threshold in gain of parameter size (classical/Noisy), to converte a classical CDP interaction into a random Noisy one.
cot_scientific_notation : bool
    Whether to use scientific notation for chain of thought.
generate_trivial : bool
    Whether to accept problem where no computationn only retriavial skills are necessary (mainly usefull for law level problems).
is_verbose : bool
    Whether to use a more humanlike description of the system, or a less verbose one that describe the Bayesian Network by listing all the conditional probabilities.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Rung12Config</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration for Rung 1 and Rung 2 tasks.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_nodes : int</span>
<span class="sd">        Number of nodes in the graph.</span>
<span class="sd">    max_domain_size : int</span>
<span class="sd">        Maximum domain size for the variables.</span>
<span class="sd">    edge_prob : float</span>
<span class="sd">        Probability of an edge between two nodes.</span>
<span class="sd">    graph_generation_mode : str</span>
<span class="sd">        Method for generating the graph (e.g., &quot;erdos&quot;).</span>
<span class="sd">    n_round : int</span>
<span class="sd">        Number of decimal places to round probabilities to.</span>
<span class="sd">    Noisy_mode : bool</span>
<span class="sd">        Whether to use the sparser Noisy interaction within the network.</span>
<span class="sd">    cpt_relative_threshold : float</span>
<span class="sd">        If Noisy_mode is True, set the conversion relative threshold in gain of parameter size (classical/Noisy), to converte a classical CDP interaction into a random Noisy one.</span>
<span class="sd">    cot_scientific_notation : bool</span>
<span class="sd">        Whether to use scientific notation for chain of thought.</span>
<span class="sd">    generate_trivial : bool</span>
<span class="sd">        Whether to accept problem where no computationn only retriavial skills are necessary (mainly usefull for law level problems).</span>
<span class="sd">    is_verbose : bool</span>
<span class="sd">        Whether to use a more humanlike description of the system, or a less verbose one that describe the Bayesian Network by listing all the conditional probabilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_nodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">max_domain_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">edge_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">graph_generation_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;erdos&quot;</span>
    <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Noisy_mode</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cpt_relative_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cot_scientific_notation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">graph_seed</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">conditionning_seed</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">concise_cot</span><span class="p">:</span> <span class="nb">bool</span>  <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># 1. Call the parent to handle the standard progression logic</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># 2. Handle specific levels</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_trivial</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_trivial</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_round</span> <span class="o">+=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">+=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_domain_size</span> <span class="o">+=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpt_relative_threshold</span> <span class="o">+=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">c</span> 


    <span class="k">def</span><span class="w"> </span><span class="nf">set_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_seed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conditionning_seed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the random seeds for reproducibility of the graph structure and the specific query.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Graph_seed : int, optional</span>
<span class="sd">            The seed used to control the generation of the Bayesian Network structure </span>
<span class="sd">            (topology, edges) and the parameters (CPDs). If provided, it ensures </span>
<span class="sd">            the &quot;laws of the world&quot; are consistent across runs.</span>
<span class="sd">        conditionning_seed : int, optional</span>
<span class="sd">            The seed used to control the selection of the target variable, </span>
<span class="sd">            evidence variables, and intervention values (the &quot;scenario&quot;). </span>
<span class="sd">            Allows generating different questions/conditions on the exact same graph.</span>
<span class="sd">            Morever, the conditionning accross rungs (association/intervention) are twined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_seed</span> <span class="o">=</span> <span class="n">graph_seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">graph_seed</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conditionning_seed</span> <span class="o">=</span> <span class="n">conditionning_seed</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">








<h5 id="reasoning_core.tasks.causal_reasoning.Rung12Config-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.Rung12Config.set_seed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_seed</span><span class="p">(</span><span class="n">graph_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conditionning_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Sets the random seeds for reproducibility of the graph structure and the specific query.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.Rung12Config.set_seed--parameters">Parameters</h6>
<p>Graph_seed : int, optional
    The seed used to control the generation of the Bayesian Network structure 
    (topology, edges) and the parameters (CPDs). If provided, it ensures 
    the "laws of the world" are consistent across runs.
conditionning_seed : int, optional
    The seed used to control the selection of the target variable, 
    evidence variables, and intervention values (the "scenario"). 
    Allows generating different questions/conditions on the exact same graph.
    Morever, the conditionning accross rungs (association/intervention) are twined.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_seed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conditionning_seed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the random seeds for reproducibility of the graph structure and the specific query.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Graph_seed : int, optional</span>
<span class="sd">        The seed used to control the generation of the Bayesian Network structure </span>
<span class="sd">        (topology, edges) and the parameters (CPDs). If provided, it ensures </span>
<span class="sd">        the &quot;laws of the world&quot; are consistent across runs.</span>
<span class="sd">    conditionning_seed : int, optional</span>
<span class="sd">        The seed used to control the selection of the target variable, </span>
<span class="sd">        evidence variables, and intervention values (the &quot;scenario&quot;). </span>
<span class="sd">        Allows generating different questions/conditions on the exact same graph.</span>
<span class="sd">        Morever, the conditionning accross rungs (association/intervention) are twined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">graph_seed</span> <span class="o">=</span> <span class="n">graph_seed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">graph_seed</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">conditionning_seed</span> <span class="o">=</span> <span class="n">conditionning_seed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="reasoning_core.tasks.causal_reasoning.SemanticTraceVE" class="doc doc-heading">
            <code>SemanticTraceVE</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pgmpy.inference.VariableElimination">VariableElimination</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SemanticTraceVE</span><span class="p">(</span><span class="n">VariableElimination</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_do</span> <span class="o">=</span> <span class="p">{}</span> 

    <span class="c1"># --- Core Logic (STABLE OLD VERSION) ---</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_working_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evidence</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses the stable dictionary-of-sets approach.&quot;&quot;&quot;</span>
        <span class="n">working_factors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">node</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">reduce</span><span class="p">([(</span><span class="n">var</span><span class="p">,</span> <span class="n">evidence</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">evidence</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="n">working_factors</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">factor</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">working_factors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_map_factors_to_cpds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_factors</span><span class="p">,</span> <span class="n">evidence</span><span class="p">):</span>
        <span class="n">unique_factors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">working_factors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">factor</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">bucket</span><span class="p">:</span>
                <span class="n">unique_factors</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">factor</span><span class="p">)]</span> <span class="o">=</span> <span class="n">factor</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;cpds&#39;</span><span class="p">):</span> <span class="k">return</span> 

        <span class="k">for</span> <span class="n">cpd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cpds</span><span class="p">:</span>
            <span class="n">temp_factor</span> <span class="o">=</span> <span class="n">cpd</span><span class="o">.</span><span class="n">to_factor</span><span class="p">()</span>
            <span class="n">reduce_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">var</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">evidence</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">temp_factor</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">reduce_list</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">reduced_factor</span> <span class="o">=</span> <span class="n">temp_factor</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">reduce_list</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reduced_factor</span> <span class="o">=</span> <span class="n">temp_factor</span>

            <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">unique_factors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">reduced_factor</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">vals_to_compare</span> <span class="o">=</span> <span class="n">reduced_factor</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span> <span class="o">!=</span> <span class="n">reduced_factor</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">axes_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">reduced_factor</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">]</span>
                        <span class="n">vals_to_compare</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">reduced_factor</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axes_order</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">continue</span>

                <span class="k">if</span> <span class="n">factor</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vals_to_compare</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">factor</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">vals_to_compare</span><span class="p">):</span>
                        <span class="n">tracker</span> <span class="o">=</span> <span class="n">SemanticTracker</span><span class="o">.</span><span class="n">from_cpd</span><span class="p">(</span><span class="n">cpd</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_do</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">factor</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tracker</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">base_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elimination_order</span><span class="o">=</span><span class="s2">&quot;MinFill&quot;</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">evidence</span> <span class="o">=</span> <span class="n">evidence</span> <span class="k">if</span> <span class="n">evidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># Pruning logic from stable version</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">DiscreteBayesianNetwork</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_reduced</span><span class="p">,</span> <span class="n">evidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prune_bayesian_model</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                 <span class="n">model_reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="n">reduced_ve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">model_reduced</span><span class="p">)</span>
        <span class="n">reduced_ve</span><span class="o">.</span><span class="n">trace_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span>
        <span class="n">reduced_ve</span><span class="o">.</span><span class="n">factor_semantics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span>
        <span class="n">reduced_ve</span><span class="o">.</span><span class="n">global_do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_do</span> 

        <span class="c1"># Manually initialize factors if parent doesn&#39;t (pgmpy quirk)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reduced_ve</span><span class="p">,</span> <span class="s1">&#39;factors&#39;</span><span class="p">):</span>
            <span class="n">reduced_ve</span><span class="o">.</span><span class="n">factors</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">cpd</span><span class="o">.</span><span class="n">to_factor</span><span class="p">()</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">cpd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_reduced</span><span class="o">.</span><span class="n">cpds</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">reduced_ve</span><span class="o">.</span><span class="n">_variable_elimination</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="s2">&quot;marginalize&quot;</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">elimination_order</span><span class="p">,</span> <span class="n">joint</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query_with_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elimination_order</span><span class="o">=</span><span class="s2">&quot;MinFill&quot;</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_query</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">elimination_order</span><span class="o">=</span><span class="n">elimination_order</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="n">joint</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_variable_elimination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">evidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elimination_order</span><span class="o">=</span><span class="s2">&quot;MinFill&quot;</span><span class="p">,</span> <span class="n">joint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Stable loop implementation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">factor_product</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">joint</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="n">eliminated_variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">working_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_working_factors</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span>
        <span class="n">elimination_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_elimination_order</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">elimination_order</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_map_factors_to_cpds</span><span class="p">(</span><span class="n">working_factors</span><span class="p">,</span> <span class="n">evidence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;INIT&quot;</span><span class="p">,</span> <span class="s2">&quot;elimination_order&quot;</span><span class="p">:</span> <span class="n">elimination_order</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">elimination_order</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">working_factors</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">eliminated_variables</span><span class="p">)]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">factors</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">working_factors</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
                <span class="n">eliminated_variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">input_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
                <span class="n">tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="n">input_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">tracker</span><span class="p">))</span>

            <span class="n">phi</span> <span class="o">=</span> <span class="n">factor_product</span><span class="p">(</span><span class="o">*</span><span class="n">factors</span><span class="p">)</span>
            <span class="n">phi_tracker</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_data</span> <span class="ow">and</span> <span class="n">input_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">SemanticTracker</span><span class="p">(</span><span class="n">heads</span><span class="o">=</span><span class="p">{</span><span class="n">var</span><span class="p">})</span> <span class="c1"># Fallback</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">next_tracker</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">next_tracker</span><span class="p">:</span> <span class="n">phi_tracker</span> <span class="o">=</span> <span class="n">phi_tracker</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">next_tracker</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">phi</span><span class="p">)]</span> <span class="o">=</span> <span class="n">phi_tracker</span>

            <span class="n">product_expr</span> <span class="o">=</span> <span class="s2">&quot; * &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">input_data</span> <span class="k">if</span> <span class="n">t</span><span class="p">])</span>
            <span class="n">product_formula</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">phi_tracker</span><span class="p">)</span>

            <span class="n">tau</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">operation</span><span class="p">)([</span><span class="n">var</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">tau_tracker</span> <span class="o">=</span> <span class="n">phi_tracker</span><span class="o">.</span><span class="n">marginalize</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">tau</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tau_tracker</span>
            <span class="n">sum_formula</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tau_tracker</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;ELIMINATE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span>
                <span class="s2">&quot;input_data&quot;</span><span class="p">:</span> <span class="n">input_data</span><span class="p">,</span>
                <span class="s2">&quot;product_data&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">phi_tracker</span><span class="p">),</span>
                <span class="s2">&quot;sum_data&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">tau_tracker</span><span class="p">),</span>
                <span class="s2">&quot;product_expr&quot;</span><span class="p">:</span> <span class="n">product_expr</span><span class="p">,</span>
                <span class="s2">&quot;product_formula&quot;</span><span class="p">:</span> <span class="n">product_formula</span><span class="p">,</span>
                <span class="s2">&quot;sum_formula&quot;</span><span class="p">:</span> <span class="n">sum_formula</span>
            <span class="p">})</span>

            <span class="k">del</span> <span class="n">working_factors</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">phi</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                 <span class="k">if</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">working_factors</span><span class="p">:</span>
                    <span class="n">working_factors</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">tau</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">tau</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">working_factors</span><span class="p">:</span>
                    <span class="n">working_factors</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">working_factors</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">tau</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span>
            <span class="n">eliminated_variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

        <span class="n">final_factors_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">working_factors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">factor</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">bucket</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">eliminated_variables</span><span class="p">):</span>
                    <span class="n">final_factors_map</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">factor</span><span class="p">)]</span> <span class="o">=</span> <span class="n">factor</span>

        <span class="n">unique_factors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">final_factors_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">final_input_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">unique_factors</span><span class="p">:</span>
            <span class="n">tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">final_input_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">tracker</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">unique_factors</span><span class="p">:</span>
            <span class="n">final_tracker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">unique_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="c1"># Handle edge case if tracker is None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">final_tracker</span><span class="p">:</span> <span class="n">final_tracker</span> <span class="o">=</span> <span class="n">SemanticTracker</span><span class="p">(</span><span class="n">heads</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">unique_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">variables</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">unique_factors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor_semantics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">ft</span><span class="p">:</span> <span class="n">final_tracker</span> <span class="o">=</span> <span class="n">final_tracker</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ft</span><span class="p">)</span>

            <span class="n">unnormalized</span> <span class="o">=</span> <span class="n">factor_product</span><span class="p">(</span><span class="o">*</span><span class="n">unique_factors</span><span class="p">)</span>
            <span class="n">clean_tracker</span> <span class="o">=</span> <span class="n">final_tracker</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">unnormalized</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">joint</span><span class="p">:</span>
                <span class="n">normalized</span> <span class="o">=</span> <span class="n">unnormalized</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMALIZE&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;final_input_data&quot;</span><span class="p">:</span> <span class="n">final_input_data</span><span class="p">,</span>
                    <span class="s2">&quot;unnormalized_data&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">unnormalized</span><span class="p">,</span> <span class="n">clean_tracker</span><span class="p">),</span>
                    <span class="s2">&quot;normalized_data&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">clean_tracker</span><span class="p">),</span>
                    <span class="s2">&quot;final_formula&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">clean_tracker</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="k">return</span> <span class="n">normalized</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">unnormalized</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">DiscreteFactor</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[],</span> <span class="n">cardinality</span><span class="o">=</span><span class="p">[],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>

    <span class="c1"># --- New Reporting Features (GRAFTED FROM NEW VERSION) ---</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_natural_language_proof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scientific_notation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">concise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the proof.</span>
<span class="sd">        :param concise: If True, returns the short unverbose CoT. If False, returns the detailed verbose trace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">concise</span><span class="p">:</span> 
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_concise_proof</span><span class="p">(</span><span class="n">scientific_notation</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_verbose_proof</span><span class="p">(</span><span class="n">scientific_notation</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">scientific</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scientific</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">:.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">e</span><span class="se">}}</span><span class="s2">&quot;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">base</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span> <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exponent</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exponent</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="n">exponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">exponent</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
                <span class="n">exponent</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">+</span> <span class="p">(</span><span class="n">num</span> <span class="k">if</span> <span class="n">num</span> <span class="k">else</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">e</span><span class="si">{</span><span class="n">exponent</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">:.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">f</span><span class="se">}}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_render_inline_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to render small distributions inline like {0: 0.2, 1: 0.8}.&quot;&quot;&quot;</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">card</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">cardinality</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">precision</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">card</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">precision</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># For multi-var, just show first few or shape? </span>
        <span class="c1"># Keeping it simple for concise mode:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[Distribution over </span><span class="si">{</span><span class="nb">vars</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_render_factor_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">semantics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scientific</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">semantics</span><span class="p">)</span> <span class="k">if</span> <span class="n">semantics</span> <span class="k">else</span> <span class="s2">&quot;Unknown Factor&quot;</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">card</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">cardinality</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">vars</span><span class="p">:</span>
            <span class="n">val_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_value</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Table for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">  [] = </span><span class="si">{</span><span class="n">val_str</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">card</span><span class="p">]</span>
        <span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">states</span><span class="p">))</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Table for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combinations</span><span class="p">):</span>
            <span class="n">assignments</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">comb</span><span class="p">)])</span>
            <span class="n">val_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_value</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [</span><span class="si">{</span><span class="n">assignments</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="n">val_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_concise_proof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;GOAL&#39;</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Goal: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;SURGERY&#39;</span><span class="p">:</span>
                <span class="n">surgery_parts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s2">&quot;Point Mass&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                        <span class="n">surgery_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Set P(&quot;</span><span class="p">,</span> <span class="s2">&quot;P(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;) :=&quot;</span><span class="p">,</span> <span class="s2">&quot;)=&quot;</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="s2">&quot;no parents&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                        <span class="n">surgery_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">surgery_parts</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Surgery: &quot;</span> <span class="o">+</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">surgery_parts</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;INIT&#39;</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elimination_order&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">order</span><span class="p">:</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elim order: </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;ELIMINATE&#39;</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
                <span class="n">tau</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;sum_data&#39;</span><span class="p">]</span>
                <span class="n">result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_inline_dist</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sum out </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;sum_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">result_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;TRIVIAL_DO&#39;</span><span class="p">:</span>
                <span class="c1"># Old version doesn&#39;t generate this, but keeping for compatibility</span>
                <span class="n">do_var</span><span class="p">,</span> <span class="n">do_val</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;do_var&#39;</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;do_val&#39;</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
                <span class="n">result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_inline_dist</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;do(</span><span class="si">{</span><span class="n">do_var</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">do_val</span><span class="si">}</span><span class="s2">) trivial -&gt; P(</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">result_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;NORMALIZE&#39;</span><span class="p">:</span>
                <span class="n">n_factor</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;normalized_data&#39;</span><span class="p">]</span>
                <span class="n">u_factor</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;unnormalized_data&#39;</span><span class="p">]</span>
                <span class="n">u_sum</span> <span class="o">=</span> <span class="n">u_factor</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_inline_dist</span><span class="p">(</span><span class="n">n_factor</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">u_sum</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;final_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">result_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normalize (sum=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">u_sum</span><span class="p">,</span><span class="w"> </span><span class="n">precision</span><span class="p">)</span><span class="si">}</span><span class="s2">) -&gt; </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;final_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">result_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_verbose_proof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">):</span>
        <span class="n">proof</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_log</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_trace_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">:</span> <span class="n">proof</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">proof</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_render_trace_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;GOAL&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Goal: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;INIT&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Initialization: Selected Elimination Order = </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;elimination_order&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;ELIMINATE&#39;</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--- Step: Eliminate Variable &#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&#39; ---&quot;</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Retrieve relevant factors containing &#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">tracker</span><span class="p">)</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;input_data&#39;</span><span class="p">]:</span>
                <span class="n">table_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_factor_table</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Compute the Intermediate Joint (Product):&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Formula: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;product_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;product_expr&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">phi</span><span class="p">,</span> <span class="n">phi_track</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;product_data&#39;</span><span class="p">]</span>
            <span class="n">table_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_factor_table</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">phi_track</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Marginalize (Sum) out variable &#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Formula: </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;sum_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="se">\u2211</span><span class="s2">_</span><span class="se">{{</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="se">}}</span><span class="s2"> </span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;product_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tau</span><span class="p">,</span> <span class="n">tau_track</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;sum_data&#39;</span><span class="p">]</span>
            <span class="n">table_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_factor_table</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">tau_track</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;NORMALIZE&#39;</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--- Final Step: Normalization ---&quot;</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Gather all remaining factors (Query Variables + Priors):&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">tracker</span><span class="p">)</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;final_input_data&#39;</span><span class="p">]:</span>
                <span class="n">table_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_factor_table</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Compute Unnormalized Joint Distribution (</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;final_formula&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="n">u_factor</span><span class="p">,</span> <span class="n">u_track</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;unnormalized_data&#39;</span><span class="p">]</span>
            <span class="n">table_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_factor_table</span><span class="p">(</span><span class="n">u_factor</span><span class="p">,</span> <span class="n">u_track</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Normalize to obtain Probability Distribution:&quot;</span><span class="p">)</span>
            <span class="n">n_factor</span><span class="p">,</span> <span class="n">n_track</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;normalized_data&#39;</span><span class="p">]</span>
            <span class="n">table_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_factor_table</span><span class="p">(</span><span class="n">n_factor</span><span class="p">,</span> <span class="n">n_track</span><span class="p">,</span> <span class="n">scientific</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]))</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="s1">&#39;SURGERY&#39;</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--- Causal Graph Surgery ---&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;details&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">








<h5 id="reasoning_core.tasks.causal_reasoning.SemanticTraceVE-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="reasoning_core.tasks.causal_reasoning.SemanticTraceVE.generate_natural_language_proof" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_natural_language_proof</span><span class="p">(</span><span class="n">scientific_notation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">concise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Generates the proof.
:param concise: If True, returns the short unverbose CoT. If False, returns the detailed verbose trace.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_natural_language_proof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scientific_notation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">concise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the proof.</span>
<span class="sd">    :param concise: If True, returns the short unverbose CoT. If False, returns the detailed verbose trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">concise</span><span class="p">:</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_concise_proof</span><span class="p">(</span><span class="n">scientific_notation</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_verbose_proof</span><span class="p">(</span><span class="n">scientific_notation</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="reasoning_core.tasks.causal_reasoning-functions">Functions</h3>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.bim_round" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bim_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>In-place rounding for Binary Influence Models with shape correction.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bim_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In-place rounding for Binary Influence Models with shape correction.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span>

    <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">)]</span>

    <span class="c1"># Create 2D array first</span>
    <span class="n">val_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># Reshape to pgmpy&#39;s expected N-dimensional shape: (var_card, parent1_card, parent2_card...)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">val_2d</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_card</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cardinality</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.bn_round" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bn_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>In-place rounding of all internal CPDs.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bn_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In-place rounding of all internal CPDs.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">cpd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpds</span><span class="p">:</span>
        <span class="n">cpd</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.cpd_round" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cpd_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>In-place rounding of TabularCPD values.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cpd_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In-place rounding of TabularCPD values.&quot;&quot;&quot;</span>
    <span class="n">original_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">flat_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">original_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">flat_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">flat_values</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_precise_round_series</span><span class="p">(</span><span class="n">flat_values</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">n_round</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">flat_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">original_shape</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">_precise_round_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.factor_to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">factor_to_dict</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">n_round</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts a 1D pgmpy posterior factor into a result dict.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">factor_to_dict</span><span class="p">(</span><span class="n">factor</span><span class="p">:</span> <span class="n">TabularCPD</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a 1D pgmpy posterior factor into a result dict.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Factor must be a 1D posterior distribution.&quot;</span><span class="p">)</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">states</span> <span class="o">=</span> <span class="n">factor</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
    <span class="n">values_rounded</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span>  <span class="n">factor</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_to_dict</span><span class="p">({</span><span class="n">state</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">values_rounded</span><span class="p">)})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.get_random_CI" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_random_CI</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">evidence</span><span class="p">,</span> <span class="n">cardinality</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="n">isLeaky</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mass_shift_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_rejection_tries</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a random CI model using Rejection Sampling to
guarantee stochastic dominance for MIMs.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_random_CI</span><span class="p">(</span>
    <span class="n">variable</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">evidence</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Hashable</span><span class="p">],</span>
    <span class="n">cardinality</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;or&#39;</span><span class="p">,</span>
    <span class="n">isLeaky</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mass_shift_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">max_rejection_tries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BinaryInfluenceModel&quot;</span><span class="p">,</span> <span class="s2">&quot;MultilevelInfluenceModel&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a random CI model using Rejection Sampling to</span>
<span class="sd">    guarantee stochastic dominance for MIMs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">mode_upper</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">child_card</span> <span class="o">=</span> <span class="n">cardinality</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
    <span class="n">parent_cards</span> <span class="o">=</span> <span class="p">[</span><span class="n">cardinality</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">evidence</span><span class="p">]</span>
    <span class="n">is_all_binary</span> <span class="o">=</span> <span class="p">(</span><span class="n">child_card</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">parent_cards</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode_upper</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span> <span class="s2">&quot;AND&quot;</span><span class="p">}:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_all_binary</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode &#39;</span><span class="si">{</span><span class="n">mode_upper</span><span class="si">}</span><span class="s2">&#39; requires binary variables.&quot;</span><span class="p">)</span>
        <span class="n">n_parents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">evidence</span><span class="p">)</span>
        <span class="n">activation_magnitude</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_parents</span><span class="p">)</span>
        <span class="n">leak</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="k">if</span> <span class="n">isLeaky</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">BinaryInfluenceModel</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">evidence</span><span class="o">=</span><span class="n">evidence</span><span class="p">,</span>
            <span class="n">activation_magnitude</span><span class="o">=</span><span class="n">activation_magnitude</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode_upper</span><span class="p">,</span>
            <span class="n">leak</span><span class="o">=</span><span class="n">leak</span><span class="p">,</span>
            <span class="n">isboolean_style</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">mode_upper</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;MAX&quot;</span><span class="p">,</span> <span class="s2">&quot;MIN&quot;</span><span class="p">}:</span>

        <span class="n">influence_tables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state_names</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">child_card</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">evidence</span><span class="p">:</span>
            <span class="n">parent_card</span> <span class="o">=</span> <span class="n">cardinality</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
            <span class="n">parent_degree</span> <span class="o">=</span> <span class="n">parent_card</span> <span class="o">*</span> <span class="n">child_card</span>
            <span class="n">parent_states</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">parent_card</span><span class="p">))</span>
            <span class="n">state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_states</span>
            <span class="n">parent_table</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">last_pmf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">child_card</span><span class="p">)</span>
            <span class="n">last_pmf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="n">pmf_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">current_alphas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="n">parent_card</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">child_card</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">child_card</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">current_alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span>

            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_pmf</span> <span class="o">=</span> <span class="n">last_pmf</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">next_alphas</span> <span class="o">=</span> <span class="n">current_alphas</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">child_card</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="c1"># Shift mass from bin i to bin i+1</span>
                        <span class="n">delta</span> <span class="o">=</span> <span class="n">next_alphas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mass_shift_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">child_card</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">parent_degree</span>
                        <span class="n">next_alphas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">delta</span>
                        <span class="n">next_alphas</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>

                    <span class="n">next_alphas</span><span class="p">[</span><span class="n">next_alphas</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
                    <span class="n">current_alphas</span> <span class="o">=</span> <span class="n">next_alphas</span>

                    <span class="n">found_sample</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_rejection_tries</span><span class="p">):</span>
                        <span class="n">new_pmf</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">dirichlet</span><span class="p">(</span><span class="n">current_alphas</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">_is_stochastically_dominant</span><span class="p">(</span><span class="n">new_pmf</span><span class="p">,</span> <span class="n">last_pmf</span><span class="p">):</span>
                            <span class="n">current_pmf</span> <span class="o">=</span> <span class="n">new_pmf</span>
                            <span class="n">found_sample</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_sample</span><span class="p">:</span>
                        <span class="n">current_pmf</span> <span class="o">=</span> <span class="n">_sample_dominant_fallback</span><span class="p">(</span><span class="n">last_pmf</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
                <span class="n">pmf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_pmf</span><span class="p">)</span>
                <span class="n">last_pmf</span> <span class="o">=</span> <span class="n">current_pmf</span>

            <span class="k">if</span> <span class="n">mode_upper</span><span class="o">==</span><span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
                <span class="n">parent_table</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">parent_states</span><span class="p">,</span><span class="n">pmf_list</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#MIN case</span>
                <span class="n">pmf_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                <span class="n">pmf_list_flip</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">,</span> <span class="n">pmf_list</span><span class="p">)</span>
                <span class="n">parent_table</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">parent_states</span><span class="p">,</span><span class="n">pmf_list_flip</span><span class="p">))</span>
            <span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_table</span>


        <span class="n">leak_probs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">isLeaky</span><span class="p">:</span>
            <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">child_card</span><span class="p">)</span>
            <span class="n">leak_probs</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">dirichlet</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MultilevelInfluenceModel</span><span class="p">(</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
            <span class="n">evidence</span><span class="o">=</span><span class="n">evidence</span><span class="p">,</span>
            <span class="n">influence_tables</span><span class="o">=</span><span class="n">influence_tables</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">child_card</span><span class="p">,</span>
            <span class="n">leak</span><span class="o">=</span><span class="n">leak_probs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode_upper</span><span class="p">,</span>
            <span class="n">state_names</span><span class="o">=</span><span class="n">state_names</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown CI mode: &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;. Must be one of &#39;OR&#39;, &#39;AND&#39;, &#39;MAX&#39;, &#39;MIN&#39;.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.get_random_DAG" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_random_DAG</span><span class="p">(</span><span class="n">n_nodes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edge_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">node_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;erdos&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a randomly generated DAG using different generation strategies.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_random_DAG</span><span class="p">(</span>
        <span class="n">n_nodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">edge_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">node_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">latents</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;erdos&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DAG&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a randomly generated DAG using different generation strategies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)]</span>

        <span class="c1"># ---- ERDSRNYI STYLE DAG ----</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;erdos&quot;</span><span class="p">:</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">edge_prob</span><span class="p">,</span> <span class="n">edge_prob</span><span class="p">])</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># ensure acyclicity</span>
            <span class="n">adj_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">node_names</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">node_names</span><span class="p">)</span>
            <span class="n">nx_dag</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_adjacency</span><span class="p">(</span><span class="n">adj_pd</span><span class="p">,</span> <span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span>

        <span class="c1"># ---- CONNECTED DAG VIA SPANNING TREE + NOISE ----</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;spanning_tree&quot;</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">node_names</span><span class="p">)</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># First, a directed spanning tree (acyclic)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">):</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">adj</span><span class="p">[</span><span class="n">parent</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># edge along order</span>

            <span class="c1"># Add extra edges probabilistically (preserve DAG)</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">edge_prob</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">extra</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">adj_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
            <span class="n">nx_dag</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_adjacency</span><span class="p">(</span><span class="n">adj_pd</span><span class="p">,</span> <span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span>

        <span class="c1"># ---- DIRECTED PREFERENTIAL ATTACHMENT ----</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;preferential&quot;</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">node_names</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">new_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">):</span>
                <span class="n">existing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">new_idx</span><span class="p">))</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">G</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">])</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="n">probs</span> <span class="o">/</span> <span class="n">probs</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">n_parents</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">new_idx</span><span class="p">)</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_parents</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node_names</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">node_names</span><span class="p">[</span><span class="n">new_idx</span><span class="p">])</span>
            <span class="n">nx_dag</span> <span class="o">=</span> <span class="n">G</span>

        <span class="c1"># ---- LAYERED DAG ----</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;layered&quot;</span><span class="p">:</span>
            <span class="n">n_layers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;n_layers&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)))</span>
            <span class="n">layer_conn_prob</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layer_conn_prob&quot;</span><span class="p">,</span> <span class="n">edge_prob</span><span class="p">)</span>

            <span class="n">layers</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layers</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_names</span><span class="p">:</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">)</span>
                <span class="n">layers</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">node_names</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">):</span>
                    <span class="n">tgt</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tgt</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">layer_conn_prob</span><span class="p">:</span>
                                <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">nx_dag</span> <span class="o">=</span> <span class="n">G</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown DAG generation method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># --- FIX: Force all nodes to be standard Python strings ---</span>
        <span class="c1"># This prevents numpy.str_ types from causing &quot;Variable not in model&quot; errors</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nx_dag</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>
        <span class="n">nx_dag</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">nx_dag</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
        <span class="c1"># --------------------------------------------------------</span>

        <span class="c1"># ---- Add latent nodes optionally ----</span>
        <span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="n">nx_dag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">latents</span><span class="p">:</span>
            <span class="n">n_latents</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">nodes</span><span class="p">())))</span>
            <span class="n">dag</span><span class="o">.</span><span class="n">latents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">nodes</span><span class="p">()),</span> <span class="n">n_latents</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">dag</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.get_random_DBN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_random_DBN</span><span class="p">(</span><span class="n">n_nodes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">edge_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">node_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">graph_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;erdos&#39;</span><span class="p">,</span> <span class="n">n_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a randomly generated Bayesian Network on <code>n_nodes</code> variables
with edge probabiliy of <code>edge_prob</code> between variables.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.get_random_DBN--parameters">Parameters</h6>
<p>n_nodes: int
    The number of nodes in the randomly generated DAG.</p>


<details class="edge_prob" open>
  <summary>float</summary>
  <p>The probability of edge between any two nodes in the topologically
sorted DAG.</p>
</details>

<details class="node_names" open>
  <summary>list (default: None)</summary>
  <p>A list of variables names to use in the random graph.
If None, the node names are integer values starting from 0.</p>
</details>

<details class="n_states" open>
  <summary>int or dict (default: None)</summary>
  <p>The number of states of each variable in the form
{variable: no_of_states}. If a single value is provided,
all nodes will have the same number of states. When None
randomly generates the number of states.</p>
</details>

<details class="latents" open>
  <summary>bool (default: False)</summary>
  <p>If True, also creates latent variables.</p>
</details>

<details class="seed" open>
  <summary>int (default: None)</summary>
  <p>The seed value for random number generators.</p>
</details>        <h6 id="reasoning_core.tasks.causal_reasoning.get_random_DBN--returns">Returns</h6>
<p>Random DAG: pgmpy.base.DAG
    The randomly generated DAG.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.get_random_DBN--examples">Examples</h6>
<blockquote>
<blockquote>
<blockquote>
<p>from pgmpy.models import DiscreteBayesianNetwork
model = DiscreteBayesianNetwork.get_random(n_nodes=5)
model.nodes()
NodeView((0, 1, 3, 4, 2))
model.edges()
OutEdgeView([(0, 1), (0, 3), (1, 3), (1, 4), (3, 4), (2, 3)])
model.cpds
[<TabularCPD representing P(0:0) at 0x7f97e16eabe0>,
 <TabularCPD representing P(1:1 | 0:0) at 0x7f97e16ea670>,
 <TabularCPD representing P(3:3 | 0:0, 1:1, 2:2) at 0x7f97e16820d0>,
 <TabularCPD representing P(4:4 | 1:1, 3:3) at 0x7f97e16eae80>,
 <TabularCPD representing P(2:2) at 0x7f97e1682c40>]</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_random_DBN</span><span class="p">(</span>
        <span class="n">n_nodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">edge_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">node_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_states</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">latents</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">graph_seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;erdos&quot;</span><span class="p">,</span>
        <span class="n">n_round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DiscreteBayesianNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a randomly generated Bayesian Network on `n_nodes` variables</span>
<span class="sd">        with edge probabiliy of `edge_prob` between variables.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_nodes: int</span>
<span class="sd">            The number of nodes in the randomly generated DAG.</span>

<span class="sd">        edge_prob: float</span>
<span class="sd">            The probability of edge between any two nodes in the topologically</span>
<span class="sd">            sorted DAG.</span>

<span class="sd">        node_names: list (default: None)</span>
<span class="sd">            A list of variables names to use in the random graph.</span>
<span class="sd">            If None, the node names are integer values starting from 0.</span>

<span class="sd">        n_states: int or dict (default: None)</span>
<span class="sd">            The number of states of each variable in the form</span>
<span class="sd">            {variable: no_of_states}. If a single value is provided,</span>
<span class="sd">            all nodes will have the same number of states. When None</span>
<span class="sd">            randomly generates the number of states.</span>

<span class="sd">        latents: bool (default: False)</span>
<span class="sd">            If True, also creates latent variables.</span>

<span class="sd">        seed: int (default: None)</span>
<span class="sd">            The seed value for random number generators.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Random DAG: pgmpy.base.DAG</span>
<span class="sd">            The randomly generated DAG.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pgmpy.models import DiscreteBayesianNetwork</span>
<span class="sd">        &gt;&gt;&gt; model = DiscreteBayesianNetwork.get_random(n_nodes=5)</span>
<span class="sd">        &gt;&gt;&gt; model.nodes()</span>
<span class="sd">        NodeView((0, 1, 3, 4, 2))</span>
<span class="sd">        &gt;&gt;&gt; model.edges()</span>
<span class="sd">        OutEdgeView([(0, 1), (0, 3), (1, 3), (1, 4), (3, 4), (2, 3)])</span>
<span class="sd">        &gt;&gt;&gt; model.cpds</span>
<span class="sd">        [&lt;TabularCPD representing P(0:0) at 0x7f97e16eabe0&gt;,</span>
<span class="sd">         &lt;TabularCPD representing P(1:1 | 0:0) at 0x7f97e16ea670&gt;,</span>
<span class="sd">         &lt;TabularCPD representing P(3:3 | 0:0, 1:1, 2:2) at 0x7f97e16820d0&gt;,</span>
<span class="sd">         &lt;TabularCPD representing P(4:4 | 1:1, 3:3) at 0x7f97e16eae80&gt;,</span>
<span class="sd">         &lt;TabularCPD representing P(2:2) at 0x7f97e1682c40&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">graph_seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;X_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">n_states</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_states</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_nodes</span><span class="p">)</span>
            <span class="n">n_states_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">n_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)}</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">n_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_states</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_nodes</span><span class="p">)</span>
            <span class="n">n_states_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">n_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)}</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">n_states</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">)</span>
            <span class="n">n_states_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">node_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">n_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)}</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">n_states_dict</span> <span class="o">=</span> <span class="n">n_states</span>

        <span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="o">.</span><span class="n">get_random</span><span class="p">(</span>
            <span class="n">n_nodes</span><span class="o">=</span><span class="n">n_nodes</span><span class="p">,</span>
            <span class="n">edge_prob</span><span class="o">=</span><span class="n">edge_prob</span><span class="p">,</span>
            <span class="n">node_names</span><span class="o">=</span><span class="n">node_names</span><span class="p">,</span>
            <span class="n">latents</span><span class="o">=</span><span class="n">latents</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">graph_seed</span><span class="p">,</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">bn_model</span> <span class="o">=</span> <span class="n">DiscreteBayesianNetwork</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">edges</span><span class="p">(),</span> <span class="n">latents</span><span class="o">=</span><span class="n">dag</span><span class="o">.</span><span class="n">latents</span><span class="p">)</span>
        <span class="n">bn_model</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

        <span class="n">cpds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bn_model</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bn_model</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="n">cpd</span> <span class="o">=</span> <span class="n">TabularCPD</span><span class="o">.</span><span class="n">get_random</span><span class="p">(</span>
                    <span class="n">variable</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">evidence</span><span class="o">=</span><span class="n">parents</span><span class="p">,</span>
                    <span class="n">cardinality</span><span class="o">=</span><span class="n">n_states_dict</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">n_round</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cpd</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n_round</span><span class="p">)</span>
            <span class="n">cpds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cpd</span><span class="p">)</span>

        <span class="n">bn_model</span><span class="o">.</span><span class="n">add_cpds</span><span class="p">(</span><span class="o">*</span><span class="n">cpds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bn_model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.get_robust_elimination_order" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_robust_elimination_order</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Stable, manual implementation of MinFill to avoid pgmpy internals.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_robust_elimination_order</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">evidence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stable, manual implementation of MinFill to avoid pgmpy internals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
    <span class="n">keep_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">evidence</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">to_eliminate</span> <span class="o">=</span> <span class="n">all_nodes</span> <span class="o">-</span> <span class="n">keep_nodes</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">to_eliminate</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>

    <span class="n">moral_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">moral_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">)</span>
    <span class="n">moral_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">)):</span>
                <span class="n">moral_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">parents</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">parents</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">working_graph</span> <span class="o">=</span> <span class="n">moral_graph</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">remaining_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_eliminate</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">remaining_nodes</span><span class="p">:</span>
        <span class="n">best_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">min_fill</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">remaining_nodes</span><span class="p">:</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">working_graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="n">fill_edges</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">n_neighbors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_neighbors</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">working_graph</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                        <span class="n">fill_edges</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">fill_edges</span> <span class="o">&lt;</span> <span class="n">min_fill</span><span class="p">:</span>
                <span class="n">min_fill</span> <span class="o">=</span> <span class="n">fill_edges</span>
                <span class="n">best_node</span> <span class="o">=</span> <span class="n">node</span>
                <span class="k">if</span> <span class="n">min_fill</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>

        <span class="n">ordering</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_node</span><span class="p">)</span>
        <span class="n">remaining_nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">best_node</span><span class="p">)</span>

        <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">working_graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">best_node</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)):</span>
                <span class="n">working_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">working_graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">best_node</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ordering</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.js_divergence" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">js_divergence</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Compute the Jensen-Shannon divergence between two discrete probability distributions.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">js_divergence</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Jensen-Shannon divergence between two discrete probability distributions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">d1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">d2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>

    <span class="n">p_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">q_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">/</span> <span class="n">p_sum</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">q_sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">/</span> <span class="n">q_sum</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">q</span><span class="p">]</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">))]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kl_divergence</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a_i</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">a_i</span> <span class="o">/</span> <span class="n">b_i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="n">a_i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">b_i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">js</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">kl_divergence</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">kl_divergence</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">js</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.js_reward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">js_reward</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>reward of guessing dg where the true distribution is dt</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/causal_reasoning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">js_reward</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;reward of guessing dg where the true distribution is dt&quot;&quot;&quot;</span>
    <span class="n">js</span> <span class="o">=</span> <span class="n">js_divergence</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">js</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="n">power</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.mim_round" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mim_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>In-place rounding for Multilevel Influence Models with shape correction.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mim_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In-place rounding for Multilevel Influence Models with shape correction.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">_precise_round_series</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">val</span><span class="p">],</span> <span class="n">n_round</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="o">=</span> <span class="n">_precise_round_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_tables</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">p</span><span class="p">:</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">probs</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_leak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">)</span>

    <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_state_names</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">)]</span>

    <span class="c1"># Create 2D array first</span>
    <span class="n">val_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># Reshape to N-dimensional shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">val_2d</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_card</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cardinality</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.to_nl_BIM" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_nl_BIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Binary Influence Models to Natural Language method.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.to_nl_BIM--parameters">Parameters</h6>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>'n_round'</td>
<td>int</td>
<td>4</td>
<td>How many digits will be print</td>
</tr>
<tr>
<td>'verbose'</td>
<td>bool</td>
<td>False</td>
<td>Verbose version or very minimalistic and probabilistic description</td>
</tr>
</tbody>
</table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_nl_BIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Binary Influence Models to Natural Language method.</span>

<span class="sd">        ## Parameters</span>

<span class="sd">        | Name | Type | Default | Description |</span>
<span class="sd">        |----|----|----|----|</span>
<span class="sd">        | &#39;n_round&#39; | int | 4 | How many digits will be print |</span>
<span class="sd">        | &#39;verbose&#39; | bool | False | Verbose version or very minimalistic and probabilistic description |</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;OR&#39;</span><span class="p">,</span> <span class="s1">&#39;AND&#39;</span><span class="p">}:</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;The mode of the interaction must be &#39;OR&#39; or &#39;AND&#39; but is instead </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[]</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;OR&#39;</span><span class="p">:</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;Noisy-OR&quot;</span>
            <span class="n">action_verb</span> <span class="o">=</span> <span class="s2">&quot;activate&quot;</span>
            <span class="n">base_action</span> <span class="o">=</span> <span class="s2">&quot;activation&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;Noisy-AND&quot;</span>
            <span class="n">action_verb</span> <span class="o">=</span> <span class="s2">&quot;inhibit&quot;</span>
            <span class="n">base_action</span> <span class="o">=</span> <span class="s2">&quot;inhibition&quot;</span>

        <span class="n">active_state</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> 

        <span class="n">base_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> is &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;influenced by its parents: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_desc</span><span class="p">)</span>

        <span class="n">concept_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Each parent may activate independently </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">, but they globally </span><span class="si">{</span><span class="n">action_verb</span><span class="si">}</span><span class="s2"> it.&quot;</span>
        <span class="p">)</span>
        <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">concept_desc</span><span class="p">)</span>
        <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;The specific contributions are:&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span><span class="p">):</span> 
            <span class="n">parent_active</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> 
            <span class="n">prob_rounded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span> 

            <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> 
                <span class="sa">f</span><span class="s2">&quot;  - When </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2"> is active (is equal to </span><span class="si">{</span><span class="n">parent_active</span><span class="si">}</span><span class="s2">), it has a &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prob_rounded</span><span class="si">}</span><span class="s2"> probability of successfully causing &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the activation of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span> 
            <span class="n">leak_prob</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_round</span><span class="p">)</span> 
            <span class="n">leak_desc_human</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;  - There is also a base-line probability (or &#39;leak&#39;). &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;If all parents are inactive, the probability of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;being &#39;</span><span class="si">{</span><span class="n">active_state</span><span class="si">}</span><span class="s2">&#39; is </span><span class="si">{</span><span class="n">leak_prob</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leak_desc_human</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">descriptions</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1">#minimalist setting</span>
        <span class="n">active_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">mag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_magnitude</span><span class="p">):</span>
            <span class="n">p_active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">weights</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mag</span><span class="p">),</span> <span class="n">n_round</span><span class="p">)</span>

        <span class="n">leak_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">n_round</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> ~ Noisy-</span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2">(leak=</span><span class="si">{</span><span class="n">leak_val</span><span class="si">}</span><span class="s2">, weights=</span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.to_nl_CPD" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_nl_CPD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts TabularCPD to a natural language description.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.to_nl_CPD--parameters">Parameters</h6>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>'n_round'</td>
<td>int</td>
<td>4</td>
<td>How many digits will be print</td>
</tr>
<tr>
<td>'verbose'</td>
<td>bool</td>
<td>False</td>
<td>Verbose version or very minimalistic and probabilistic description</td>
</tr>
</tbody>
</table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_nl_CPD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts TabularCPD to a natural language description.</span>

<span class="sd">        ## Parameters</span>

<span class="sd">        | Name | Type | Default | Description |</span>
<span class="sd">        |----|----|----|----|</span>
<span class="sd">        | &#39;n_round&#39; | int | 4 | How many digits will be print |</span>
<span class="sd">        | &#39;verbose&#39; | bool | False | Verbose version or very minimalistic and probabilistic description |</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
                <span class="n">parent_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span>
                <span class="n">parent_states</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parent_vars</span><span class="p">]</span>
                <span class="n">parent_combos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">parent_states</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parent_vars</span> <span class="o">=</span> <span class="p">[]</span>  
                <span class="n">parent_combos</span> <span class="o">=</span> <span class="p">[()]</span>

            <span class="n">child_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span>
            <span class="n">probs_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">combo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parent_combos</span><span class="p">):</span>

                <span class="n">cond_parts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parent_vars</span><span class="p">,</span> <span class="n">combo</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">cond_desc</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cond_parts</span><span class="p">)</span>

                <span class="n">probs_col</span> <span class="o">=</span> <span class="n">probs_table</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">prob_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">child_states</span><span class="p">):</span>
                    <span class="n">prob</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">probs_col</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">n_round</span><span class="p">)</span>
                    <span class="n">prob_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="n">prob</span><span class="p">))</span>

                <span class="n">prob_text</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The probability of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">prob</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">prob_list</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">cond_desc</span><span class="p">:</span>
                    <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;If </span><span class="si">{</span><span class="n">cond_desc</span><span class="si">}</span><span class="s2">, then </span><span class="si">{</span><span class="n">prob_text</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prob_text</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">descriptions</span>


        <span class="k">else</span><span class="p">:</span> <span class="c1">#not verbose case, fully conditional probabilistic version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="kc">None</span>
            <span class="n">child_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span>
            <span class="n">probs_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="nb">float</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">probs_table</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">n_round</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">child_states</span><span class="p">)}</span>
                <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;P(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">probs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">parent_combos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">combo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parent_combos</span><span class="p">):</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">,</span> <span class="n">combo</span><span class="p">))</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="nb">float</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">probs_table</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">n_round</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">child_states</span><span class="p">)}</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">cond</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">probs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.to_nl_DBN" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_nl_DBN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts the entire Bayesian Network into a Natural Language description.</p>
<p>It iterates over each node and calls its CPD's .to_NL() method.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_nl_DBN</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the entire Bayesian Network into a Natural Language description.</span>

<span class="sd">        It iterates over each node and calls its CPD&#39;s .to_NL() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_description</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">cpd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpds</span><span class="p">():</span>
            <span class="n">node_nl_lines</span> <span class="o">=</span> <span class="n">cpd</span><span class="o">.</span><span class="n">to_nl</span><span class="p">(</span>
                <span class="n">n_round</span><span class="o">=</span><span class="n">n_round</span><span class="p">,</span>
                <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">full_description</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node_nl_lines</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">full_description</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="reasoning_core.tasks.causal_reasoning.to_nl_MIM" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_nl_MIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Multivariate Influence Models to Natural Language method.</p>
<h6 id="reasoning_core.tasks.causal_reasoning.to_nl_MIM--parameters">Parameters</h6>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>'n_round'</td>
<td>int</td>
<td>4</td>
<td>How many digits will be print</td>
</tr>
<tr>
<td>'verbose'</td>
<td>bool</td>
<td>False</td>
<td>Verbose version or very minimalistic and probabilistic description</td>
</tr>
</tbody>
</table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>reasoning_core/tasks/_causal_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_nl_MIM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multivariate Influence Models to Natural Language method.</span>

<span class="sd">        ## Parameters</span>

<span class="sd">        | Name | Type | Default | Description |</span>
<span class="sd">        |----|----|----|----|</span>
<span class="sd">        | &#39;n_round&#39; | int | 4 | How many digits will be print |</span>
<span class="sd">        | &#39;verbose&#39; | bool | False | Verbose version or very minimalistic and probabilistic description |</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">model_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Noisy-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">child_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span>

        <span class="n">base_desc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The variable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> is the result of a </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> interaction due to its parents &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="p">)</span>
        <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_desc</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
            <span class="n">parent_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">state</span><span class="p">]</span>                    
                <span class="n">prob_parts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">probs</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                        <span class="n">prob_rounded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span>
                        <span class="n">prob_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">child_states</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2">)=</span><span class="si">{</span><span class="n">prob_rounded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">prob_desc</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prob_parts</span><span class="p">)</span>
                <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;  - The influence of </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="si">}</span><span class="s2"> (when others are inactive) is: [</span><span class="si">{</span><span class="n">prob_desc</span><span class="si">}</span><span class="s2">].&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span>
            <span class="n">prob_parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">prob_rounded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">n_round</span><span class="p">)</span>
                    <span class="n">prob_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">child_states</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s2">)=</span><span class="si">{</span><span class="n">prob_rounded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">prob_desc</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prob_parts</span><span class="p">)</span>
            <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;  - The leak distribution (when all parents are inactive) is: [</span><span class="si">{</span><span class="n">prob_desc</span><span class="si">}</span><span class="s2">].&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">descriptions</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1">#unverbose one</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isleaky</span><span class="p">:</span>
            <span class="n">leak_dist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">n_round</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">leak</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">leak_dist</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>

        <span class="n">influences</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="p">:</span>
            <span class="n">parent_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_names</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
            <span class="n">parent_effects</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">parent_states</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">influence_tables</span><span class="p">[</span><span class="n">parent</span><span class="p">][</span><span class="n">state</span><span class="p">]</span>
                <span class="n">dist_fmt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">n_round</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">]</span>
                <span class="n">parent_effects</span><span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dist_fmt</span>

            <span class="n">influences</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_effects</span>

        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="si">}</span><span class="s2"> ~ Noisy-</span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2">(leak=</span><span class="si">{</span><span class="n">leak_dist</span><span class="si">}</span><span class="s2">, influences=</span><span class="si">{</span><span class="n">influences</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "navigation.tracking", "navigation.indexes", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>